# フラッシュカードシステム要件定義書

## 1. システム概要

### 1.1 目的
- ユーザーが学習用のフラッシュカードを作成・管理・学習できるWebアプリケーションを提供する
- 間隔反復学習による効率的な学習を支援する

## 2. 機能要件

### 2.1 ユーザー管理機能
- ユーザー登録
- ログイン・ログアウト
- ユーザープロフィール管理

### 2.2 デッキ管理機能
- デッキの作成・編集・削除
- デッキ一覧表示
- デッキ内のカード一覧表示

### 2.3 カード管理機能
- カードの作成・編集・削除
- 表面・裏面それぞれにテキストと画像を設定可能
- タグの付与・削除
- カードの検索（タグ、テキスト内容による）

### 2.4 学習機能
- カードの表示・裏返し
- 正誤の自己申告入力
- SM-2アルゴリズムによる間隔反復学習の実装
- 学習履歴の記録・表示
- 学習進捗の可視化

### 2.5 タグ管理機能
- タグの作成
  - カードの作成・編集時に新規タグを追加可能
  - タグ名はシステム全体でユニーク
  - 一度作成されたタグは編集・削除不可
- タグの一覧表示
  - 既存タグの検索・参照
  - カード作成・編集時の入力補完に使用
- タグによるカードのフィルタリング
  - デッキ内のカードをタグで絞り込み

### 2.6 学習分析機能
- 学習進捗の可視化
  - デッキごとの学習進捗
    - 正答率の推移（日次、週次、月次）
    - 学習カード数の推移
    - 未学習カードの割合
  - カードごとの詳細分析
    - 個別カードの正答率
    - 最後の学習からの経過日数
    - 学習回数

## 3. 非機能要件

### 3.1 性能要件
- ページロード時間：3秒以内
- 同時接続ユーザー数：100人以上
- データベース応答時間：1秒以内

### 3.2 セキュリティ要件
- パスワードの暗号化保存
- セッション管理
- XSS対策
- CSRF対策

### 3.3 可用性要件
- サービス稼働率：99.9%
- データバックアップ：日次

### 3.4 データ制限要件
- 画像ファイル形式：PNG、JPEG
- 画像サイズ制限：1920x1080ピクセル以下
- 画像ファイルサイズ：1枚あたり2MB以下
- 学習履歴の保持期間：無期限

### 3.5 バッチ処理要件
- 未使用画像の自動削除
  - 実行頻度：週次
  - 対象：カードに紐付けられていない画像ファイル
  - 処理内容：
    - `card_images`テーブルに存在しない画像をR2から削除
    - 削除に失敗した画像は次回バッチで再試行

## 4. 補足事項

### 4.1 間隔反復学習アルゴリズム
- SM-2アルゴリズムを採用
- カードごとに以下のパラメータを管理
  - 復習間隔（interval）
  - 易しさ係数（easeFactor）
  - 次回学習日（nextStudyDate）
